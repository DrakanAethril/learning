<div class="row mb-3">
    <div class="accordion" id="accordionQuizz">
        {{ include('resources/quizz/tpl_questions.html.twig', {idQ:'1', showElem:'show'})}}
        {{ include('resources/quizz/tpl_questions.html.twig', {idQ:'2', showElem:''})}}
        {{ include('resources/quizz/tpl_questions.html.twig', {idQ:'3', showElem:''})}}

    </div>
</div>
<div class="col-xl-12">
    <button class="btn btn-secondary px-5 js-quizz-elem-add">Ajouter un élément</button>
</div>

<div class="d-none" id="quizz_tpl_empty_q">
    {{ include('resources/quizz/tpl_questions.html.twig', {idQ:'%IDQ%', showElem:'', addCollapseEvent: '%COLLAPSE%'})}}
</div>
<div class="d-none" id="quizz_tpl_empty_a">
    {{ include('resources/quizz/tpl_answer.html.twig', {idQ:'%IDQ%', idR:'%IDR%', showElem:'', addCollapseEvent: '%COLLAPSE%'})}}
</div>

<script type="text/javascript">

 $(document).ready(function () {
    $('#quizz_tpl_empty_q').find('.accordion-collapse').removeClass('accordion-collapse').removeClass('collapse');
    $('#quizz_tpl_empty_q').find('.accordion-item').removeClass('accordion-item');

    $('body').on('click','.js-quizz-elem-add', function(e) {
        let idQ = $('#accordionQuizz').find(".js-quizz-elem-main").last().data('qid');
        if(isNaN(idQ)) {
            idQ = 0;
        }
        let newIdQ = idQ + 1;
        let contentE = $('#quizz_tpl_empty_q').html().replace(/%IDQ%/g, newIdQ+'');
        $('#accordionQuizz').append(contentE);

        $("#accordion"+newIdQ+'').addClass('accordion-collapse').addClass('collapse');
        $("#quizz-elem"+newIdQ+'').addClass('accordion-item');

        e.stopPropagation();
        e.preventDefault();
    });

    $('body').on('click','.js-quizz-answer-delete',function(e) {
        $(this).closest(".js-quizz-answer").remove();
        e.stopPropagation();
        e.preventDefault();
    });

    $('body').on('click','.js-quizz-elem-delete', function(e) {
        $(this).closest(".js-quizz-elem-main").remove();
        e.stopPropagation();
        e.preventDefault();
    });

    //$(".js-quizz-answer-add").on("click", function(e) {
    $('body').on('click','.js-quizz-answer-add', function(e) {
        let idQ = $(this).closest(".js-quizz-elem-main").data( "qid" );
        let idR = $(this).closest(".js-quizz-elem-main").find(".js-quizz-answers").find(".js-quizz-answer").last().data('aid');
        if(isNaN(idR)) {
            idR = 0;
        }
        let newIdR = idR + 1;
        let contentR = $('#quizz_tpl_empty_a').html().replace(/%IDQ%/g, idQ+'').replace(/%IDR%/g, newIdR+'');
         $(this).closest(".js-quizz-elem-main").find(".js-quizz-answers").append(contentR);
        e.stopPropagation();
        e.preventDefault();
    });
});

</script>